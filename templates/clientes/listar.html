{% extends 'base.html' %}

{% block title %}Clientes - FITTECH{% endblock %}

{% block content %}
<div class="page-header">
    <h1>Gestión de Clientes</h1>
    <a href="{% url 'clientes_crear' %}" class="btn btn-primary">+ Nuevo Cliente</a>
</div>

<!-- FILTROS -->
<div class="card" style="margin-bottom: 2rem;">
    <form method="GET" action="{% url 'clientes_listar' %}" style="display: flex; gap: 1rem; align-items: flex-end; flex-wrap: wrap;">
        <div style="flex: 1; min-width: 250px;">
            <label for="busqueda" style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: #374151;">Buscar:</label>
            <input 
                type="text" 
                id="busqueda" 
                name="busqueda" 
                class="input" 
                placeholder="Nombre, documento, email..."
                value="{{ busqueda }}">
        </div>
        <div style="min-width: 200px;">
            <label for="estado" style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: #374151;">Estado:</label>
            <select id="estado" name="estado" class="input">
                <option value="todos" {% if estado_filtro == 'todos' %}selected{% endif %}>Todos</option>
                <option value="activo" {% if estado_filtro == 'activo' %}selected{% endif %}>Activos</option>
                <option value="por_vencer" {% if estado_filtro == 'por_vencer' %}selected{% endif %}>Próximos a Vencer</option>
                <option value="pendiente" {% if estado_filtro == 'pendiente' %}selected{% endif %}>Pendientes</option>
                <option value="inactivo" {% if estado_filtro == 'inactivo' %}selected{% endif %}>Inactivos</option>
            </select>
        </div>
        <div style="display: flex; gap: 0.5rem;">
            <button type="submit" class="btn btn-primary">Buscar</button>
            <a href="{% url 'clientes_listar' %}" class="btn btn-secondary">Limpiar</a>
        </div>
    </form>
</div>

<div class="card">
    <div class="table-responsive">
        <table>
            <thead>
                <tr>
                    <th>Tipo Doc.</th>
                    <th>Documento</th>
                    <th>Nombre</th>
                    <th>Email</th>
                    <th>Teléfono</th>
                    <th>Estado</th>
                    <th>Membresía Vence</th>
                    <th style="text-align: center;">Acciones</th>
                </tr>
            </thead>
            <tbody>
                {% if clientes %}
                    {% for cliente in clientes %}
                    <tr>
                        <td><span class="badge-tipo-doc">{{ cliente.get_tipo_documento_display_short }}</span></td>
                        <td><strong>{{ cliente.documento }}</strong></td>
                        <td>{{ cliente.nombres }} {{ cliente.apellidos }}</td>
                        <td>{{ cliente.email|default:"-" }}</td>
                        <td>{{ cliente.celular|default:"-" }}</td>
                        <td>
                            {% if cliente.estado == 'activo' %}
                                <span class="badge badge-success">Activo</span>
                            {% elif cliente.estado == 'pendiente' %}
                                <span class="badge badge-warning">Pendiente</span>
                            {% else %}
                                <span class="badge badge-danger">Inactivo</span>
                            {% endif %}
                        </td>
                        <td>{% if cliente.fecha_fin_membresia %}{{ cliente.fecha_fin_membresia|date:"d/m/Y" }}{% else %}-{% endif %}</td>
                        <td style="text-align: center;">
                            <div class="action-buttons-grid">
                                <a href="{% url 'clientes_ver' cliente.documento %}" class="btn-icon btn-success" title="Ver detalles">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                                        ircle cx="12" cy="12" r="3"></circle>
                                    </svg>
                                </a>
                                <a href="{% url 'pagos_registrar' cliente.documento %}" class="btn-icon btn-warning" title="{% if cliente.estado == 'inactivo' %}Renovar Membresía{% else %}Registrar Pago{% endif %}">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <rect x="1" y="4" width="22" height="16" rx="2" ry="2"></rect>
                                        <line x1="1" y1="10" x2="23" y2="10"></line>
                                    </svg>
                                </a>
                                <a href="{% url 'clientes_editar' cliente.documento %}" class="btn-icon btn-info" title="Editar">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                                        <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                                    </svg>
                                </a>
                                <a href="{% url 'clientes_eliminar' cliente.documento %}" class="btn-icon btn-danger" title="Eliminar" onclick="return confirm('¿Está seguro de eliminar este cliente?')">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <polyline points="3 6 5 6 21 6"></polyline>
                                        <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                                        <line x1="10" y1="11" x2="10" y2="17"></line>
                                        <line x1="14" y1="11" x2="14" y2="17"></line>
                                    </svg>
                                </a>
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                {% else %}
                    <tr>
                        <td colspan="8" style="text-align: center; padding: 2rem; color: #6b7280;">
                            No se encontraron clientes
                        </td>
                    </tr>
                {% endif %}
            </tbody>
        </table>
    </div>
</div>

<style>
.input {width: 100%; padding: 0.75rem; border: 2px solid #e5e7eb; border-radius: 8px; font-size: 1rem; transition: all 0.3s;}
.input:focus {outline: none; border-color: #6366f1; box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);}
select.input {cursor: pointer; background: white;}
.page-header {display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;}
.btn {display: inline-block; padding: 0.75rem 1.5rem; border-radius: 8px; text-decoration: none; font-weight: 600; transition: all 0.3s; border: none; cursor: pointer; font-size: 1rem;}
.btn-primary {background: #6366f1; color: white;}
.btn-primary:hover {background: #4f46e5; transform: translateY(-2px); box-shadow: 0 4px 12px rgba(99, 102, 241, 0.4);}
.btn-secondary {background: #6b7280; color: white;}
.btn-secondary:hover {background: #4b5563;}
.btn-icon {display: inline-flex; align-items: center; justify-content: center; width: 36px; height: 36px; border-radius: 8px; text-decoration: none; transition: all 0.3s;}
.btn-icon:hover {transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);}
.btn-icon.btn-success {background: #10b981; color: white;}
.btn-icon.btn-success:hover {background: #059669;}
.btn-icon.btn-warning {background: #f59e0b; color: white;}
.btn-icon.btn-warning:hover {background: #d97706;}
.btn-icon.btn-info {background: #3b82f6; color: white;}
.btn-icon.btn-info:hover {background: #2563eb;}
.btn-icon.btn-danger {background: #ef4444; color: white;}
.btn-icon.btn-danger:hover {background: #dc2626;}
.card {background: white; border-radius: 10px; padding: 2rem; box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);}
.table-responsive {overflow-x: auto;}
table {width: 100%; border-collapse: collapse; background: white;}
table thead {background: #6366f1; color: white;}
table th, table td {padding: 1rem; text-align: left; border-bottom: 1px solid #e5e7eb;}
table tbody tr:hover {background: #f3f4f6;}
.badge {display: inline-block; padding: 0.4rem 0.8rem; border-radius: 20px; font-size: 0.85rem; font-weight: 600;}
.badge-success {background: #d1fae5; color: #065f46;}
.badge-warning {background: #fef3c7; color: #92400e;}
.badge-danger {background: #fee2e2; color: #991b1b;}

/* Badge para tipo de documento */
.badge-tipo-doc {
    display: inline-block;
    padding: 0.35rem 0.7rem;
    border-radius: 6px;
    font-size: 0.8rem;
    font-weight: 700;
    background: #dbeafe;
    color: #1e40af;
    letter-spacing: 0.5px;
}

/* Grid de botones de acciones (2x2) */
.action-buttons-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 0.5rem;
    justify-items: center;
    max-width: 90px;
    margin: 0 auto;
}
</style>
{% endblock %}